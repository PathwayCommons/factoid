/*
 ShareJS v0.2.2
 http://sharejs.org

 Copyright 2011 ShareJS Authors

 BSD licensed:
 https://github.com/josephg/ShareJS/raw/master/LICENSE
*/
function i(l){throw l;}var j=void 0,m=null;
(function(){var l,k,n,p,q,o,r,u,s,t,h,v=Array.prototype.slice;o={};u=(typeof process!=="undefined"&&process!==m?process.p:j)||function(a){return setTimeout(a,0)};l=function(){function a(){}a.prototype.f=function(b,c){var a;this.c||(this.c={});(a=this.c)[b]||(a[b]=[]);this.c[b].push(c);return this};a.prototype.g=function(b,c){var a,d;this.c||(this.c={});d=(a=this.c)[b]||(a[b]=[]);for(a=0;a<d.length;)d[a]===c&&(d[a]=j),a++;u(function(){var b;return d=function(){var a,c,e;e=[];a=0;for(c=d.length;a<c;a++)(b=
d[a])&&e.push(b);return e}()});return this};a.prototype.e=function(){var b,a,e,d,f;a=arguments[0];b=2<=arguments.length?v.call(arguments,1):[];if(!((e=this.c)!=m&&e[a]))return this;f=this.c[a];e=0;for(d=f.length;e<d;e++)(a=f[e])&&a.apply(this,b);return this};return a}();l.o=function(a){var b;b=a.prototype||a;b.f=b.on=l.prototype.f;b.g=b.removeListener=l.prototype.g;b.e=l.prototype.e;return a};if(typeof module!=="undefined"&&module!==m&&module.h)module.h=l;h={name:"text-tp2",s:!0,n:function(){return[]}};
p=function(a){var b,c,e,d,f;Array.i(a)||i(Error("Op must be an array of components"));c=m;f=[];e=0;for(d=a.length;e<d;e++)b=a[e],typeof b==="object"?b.a!==j?typeof b.a==="string"&&b.a.length>0||typeof b.a==="number"&&b.a>0||i(Error("Inserts must insert a string or a +ive number")):b.b!==j?typeof b.b==="number"&&b.b>0||i(Error("Deletes must be a +ive number")):i(Error("Operation component must define .i or .d")):(typeof b!=="number"&&i(Error("Op components must be objects or numbers")),b>0||i(Error("Skip components must be a positive number")),
typeof c==="number"&&i(Error("Adjacent skip components should be combined"))),f.push(c=b)};h.r=function(a){var b;return function(){var c,e,d;d=[];c=0;for(e=a.length;c<e;c++)b=a[c],typeof b==="string"&&d.push(b);return d}().join("")};h.l=s=function(a,b,c){var e;b.index>=a.length&&i(Error("Operation goes past the end of the document"));a=a[b.index];e=typeof a==="string"?a.slice(b.d,b.d+c):Math.min(c,a-b.d);(a.length||a)-b.d>c?b.d+=c:(b.index++,b.d=0);return e};h.k=n=function(a,b){a.length===0?a.push(b):
typeof a[a.length-1]===typeof b?a[a.length-1]+=b:a.push(b)};h.apply=function(a,b){var c,e,d,f,g,k,h;Array.i(a)||i(Error("Snapshot is invalid"));p(b);e=[];f={index:0,d:0};k=0;for(h=b.length;k<h;k++)if(c=b[k],typeof c==="number")for(g=c;g>0;)d=s(a,f,g),n(e,d),g-=d.length||d;else if(c.a!==j)n(e,c.a);else if(c.b!==j){for(g=c.b;g>0;)d=s(a,f,g),g-=d.length||d;n(e,c.b)}return e};h.j=k=function(a,b){var c;if(!(b===0||b.a===""||b.a===0||b.b===0))return a.length===0?a.push(b):(c=a[a.length-1],typeof b==="number"&&
typeof c==="number"?a[a.length-1]+=b:b.a!==j&&c.a!=m&&typeof c.a===typeof b.a?c.a+=b.a:b.b!==j&&c.b!=m?c.b+=b.b:a.push(b))};r=function(a){var b,c;c=b=0;return[function(e,d){var f,g;if(b===a.length)return m;g=a[b];return typeof(f=g)==="number"||typeof(f=g.a)==="number"||(f=g.b)!==j?(e==m||f-c<=e||d&&g.a!==j?(f-=c,++b,c=0):(c+=e,f=e),g.a!==j?{a:f}:g.b!==j?{b:f}:f):(e==m||g.a.length-c<=e||d?(g={a:g.a.slice(c)},++b,c=0):(g={a:g.a.slice(c,c+e)},c+=e),g)},function(){return a[b]}]};q=function(a){return typeof a===
"number"?a:typeof a.a==="string"?a.a.length:a.b||a.a};h.normalize=function(a){var b,c,e,d;c=[];e=0;for(d=a.length;e<d;e++)b=a[e],k(c,b);return c};t=function(a,b,c,e){var d,f,g,h,l,n,o;p(a);p(b);g=[];f=r(a);a=f[0];h=f[1];l=0;for(n=b.length;l<n;l++)if(d=b[l],f=q(d),d.a!==j)if(c){if(e==="left")for(;((o=h())!=m?o.a:j)!==j;)k(g,a());k(g,f)}else for(;f>0;)d=a(f,!0),d===m&&i(Error("The transformed op is invalid")),d.b!==j&&i(Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.")),
typeof d==="number"?f-=d:k(g,d);else for(;f>0;)d=a(f,!0),d===m&&i(Error("The op traverses more elements than the document has")),k(g,d),d.a||(f-=q(d));for(;d=a();)d.a===j&&i(Error("Remaining fragments in the op: "+d)),k(g,d);return g};h.transform=function(a,b,c){c==="left"||c==="right"||i(Error("side ("+c+") should be 'left' or 'right'"));return t(a,b,!0,c)};h.q=function(a,b){return t(a,b,!1)};h.m=function(a,b){var c,e,d,f,g,h,l;p(a);p(b);f=[];g=r(a)[0];h=0;for(l=b.length;h<l;h++)if(c=b[h],typeof c===
"number")for(d=c;d>0;)c=g(d),c===m&&i(Error("The op traverses more elements than the document has")),k(f,c),d-=q(c);else if(c.a!==j)k(f,{a:c.a});else for(d=c.b;d>0;)c=g(d),c===m&&i(Error("The op traverses more elements than the document has")),e=q(c),c.a!==j?k(f,{a:e}):k(f,{b:e}),d-=e;for(;c=g();)c.a===j&&i(Error("Remaining fragments in op1: "+c)),k(f,c);return f};o.types||(o.types={});o.types["text-tp2"]=h}).call(this);