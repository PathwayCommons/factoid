(function(){var a,b,c,d,e=!0,f=window.sharejs;typeof e!="undefined"&&e!==null?d=f.types.text:d=require("./text"),c={},c.name="json",c.create=function(){return null},c.invertComponent=function(a){var b={p:a.p};return a.si!==void 0&&(b.sd=a.si),a.sd!==void 0&&(b.si=a.sd),a.oi!==void 0&&(b.od=a.oi),a.od!==void 0&&(b.oi=a.od),a.li!==void 0&&(b.ld=a.li),a.ld!==void 0&&(b.li=a.ld),a.na!==void 0&&(b.na=-a.na),a.lm!==void 0&&(b.lm=a.p[a.p.length-1],b.p=a.p.slice(0,a.p.length-1).concat([a.lm])),b},c.invert=function(a){var b,d,e,f=a.slice().reverse(),g=[];for(d=0,e=f.length;d<e;d++)b=f[d],g.push(c.invertComponent(b));return g},c.checkValidOp=function(){},b=function(a){return Object.prototype.toString.call(a)==="[object Array]"},c.checkList=function(a){if(!b(a))throw new Error("Referenced element not a list")},c.checkObj=function(a){if(a.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(a)+")")},c.apply=function(b,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;c.checkValidOp(d),d=a(d),f={data:a(b)};try{for(i=0,o=d.length;i<o;i++){e=d[i],l=null,m=null,h=f,j="data",q=e.p;for(n=0,p=q.length;n<p;n++){k=q[n],l=h,m=j,h=h[j],j=k;if(l==null)throw new Error("Path invalid")}if(e.na!==void 0){if(typeof h[j]!="number")throw new Error("Referenced element not a number");h[j]+=e.na}else if(e.si!==void 0){if(typeof h!="string")throw new Error("Referenced element not a string (it was "+JSON.stringify(h)+")");l[m]=h.slice(0,j)+e.si+h.slice(j)}else if(e.sd!==void 0){if(typeof h!="string")throw new Error("Referenced element not a string");if(h.slice(j,j+e.sd.length)!==e.sd)throw new Error("Deleted string does not match");l[m]=h.slice(0,j)+h.slice(j+e.sd.length)}else if(e.li!==void 0&&e.ld!==void 0)c.checkList(h),h[j]=e.li;else if(e.li!==void 0)c.checkList(h),h.splice(j,0,e.li);else if(e.ld!==void 0)c.checkList(h),h.splice(j,1);else if(e.lm!==void 0)c.checkList(h),e.lm!==j&&(g=h[j],h.splice(j,1),h.splice(e.lm,0,g));else if(e.oi!==void 0)c.checkObj(h),h[j]=e.oi;else if(e.od!==void 0)c.checkObj(h),delete h[j];else throw new Error("invalid / missing instruction in op")}}catch(r){throw r}return f.data},c.pathMatches=function(a,b,c){var d,e,f;if(a.length!==b.length)return!1;for(d=0,f=a.length;d<f;d++){e=a[d];if(e!==b[d]&&(!c||d!==a.length-1))return!1}return!0},c.append=function(b,d){var e;return d=a(d),b.length!==0&&c.pathMatches(d.p,(e=b[b.length-1]).p)?e.na!==void 0&&d.na!==void 0?b[b.length-1]={p:e.p,na:e.na+d.na}:e.li!==void 0&&d.li===void 0&&d.ld===e.li?e.ld!==void 0?delete e.li:b.pop():e.od!==void 0&&e.oi===void 0&&d.oi!==void 0&&d.od===void 0?e.oi=d.oi:d.lm!==void 0&&d.p[d.p.length-1]===d.lm?null:b.push(d):b.push(d)},c.compose=function(b,d){var e,f,g,h;c.checkValidOp(b),c.checkValidOp(d),f=a(b);for(g=0,h=d.length;g<h;g++)e=d[g],c.append(f,e);return f},c.normalize=function(a){var d,e,f,g,h=[];b(a)||(a=[a]);for(e=0,f=a.length;e<f;e++)d=a[e],(g=d.p)==null&&(d.p=[]),c.append(h,d);return h},a=function(a){return JSON.parse(JSON.stringify(a))},c.commonPath=function(a,b){var c;a=a.slice(),b=b.slice(),a.unshift("data"),b.unshift("data"),a=a.slice(0,a.length-1),b=b.slice(0,b.length-1);if(b.length===0)return-1;c=0;while(a[c]===b[c]&&c<a.length){c++;if(c===b.length)return c-1}},c.transformComponent=function(b,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;e=a(e),e.na!==void 0&&e.p.push(0),f.na!==void 0&&f.p.push(0),h=c.commonPath(e.p,f.p),i=c.commonPath(f.p,e.p),l=e.p.length,p=f.p.length,e.na!==void 0&&e.p.pop(),f.na!==void 0&&f.p.pop();if(f.na)return i!=null&&p>=l&&f.p[i]===e.p[i]&&(e.ld!==void 0?(o=a(f),o.p=o.p.slice(l),e.ld=c.apply(a(e.ld),[o])):e.od!==void 0&&(o=a(f),o.p=o.p.slice(l),e.od=c.apply(a(e.od),[o]))),c.append(b,e),b;i!=null&&p>l&&e.p[i]===f.p[i]&&(e.ld!==void 0?(o=a(f),o.p=o.p.slice(l),e.ld=c.apply(a(e.ld),[o])):e.od!==void 0&&(o=a(f),o.p=o.p.slice(l),e.od=c.apply(a(e.od),[o])));if(h!=null){j=l===p;if(f.na===void 0)if(f.si!==void 0||f.sd!==void 0){if(e.si!==void 0||e.sd!==void 0){if(!j)throw new Error("must be a string?");k=function(a){var b={p:a.p[a.p.length-1]};return a.si?b.i=a.si:b.d=a.sd,b},v=k(e),w=k(f),t=[],d._tc(t,v,w,g);for(y=0,z=t.length;y<z;y++)u=t[y],n={p:e.p.slice(0,h)},n.p.push(u.p),u.i!=null&&(n.si=u.i),u.d!=null&&(n.sd=u.d),c.append(b,n);return b}}else if(f.li!==void 0&&f.ld!==void 0){if(f.p[h]===e.p[h]){if(!j)return b;if(e.ld!==void 0)if(e.li!==void 0&&g==="left")e.ld=a(f.li);else return b}}else if(f.li!==void 0)e.li!==void 0&&e.ld===void 0&&j&&e.p[h]===f.p[h]?g==="right"&&e.p[h]++:f.p[h]<=e.p[h]&&e.p[h]++,e.lm!==void 0&&j&&f.p[h]<=e.lm&&e.lm++;else if(f.ld!==void 0){if(e.lm!==void 0&&j){if(f.p[h]===e.p[h])return b;s=f.p[h],m=e.p[h],x=e.lm,(s<x||s===x&&m<x)&&e.lm--}if(f.p[h]<e.p[h])e.p[h]--;else if(f.p[h]===e.p[h]){if(p<l)return b;if(e.ld!==void 0)if(e.li!==void 0)delete e.ld;else return b}}else if(f.lm!==void 0)if(e.lm!==void 0&&l===p){m=e.p[h],x=e.lm,q=f.p[h],r=f.lm;if(q!==r)if(m===q)if(g==="left")e.p[h]=r,m===x&&(e.lm=r);else return b;else m>q&&e.p[h]--,m>r?e.p[h]++:m===r&&q>r&&(e.p[h]++,m===x&&e.lm++),x>q?e.lm--:x===q&&x>m&&e.lm--,x>r?e.lm++:x===r&&(r>q&&x>m||r<q&&x<m?g==="right"&&e.lm++:x>m?e.lm++:x===q&&e.lm--)}else e.li!==void 0&&e.ld===void 0&&j?(m=f.p[h],x=f.lm,s=e.p[h],s>m&&e.p[h]--,s>x&&e.p[h]++):(m=f.p[h],x=f.lm,s=e.p[h],s===m?e.p[h]=x:(s>m&&e.p[h]--,s>x?e.p[h]++:s===x&&m>x&&e.p[h]++));else if(f.oi!==void 0&&f.od!==void 0){if(e.p[h]===f.p[h]){if(e.oi===void 0||!j)return b;if(g==="right")return b;e.od=f.oi}}else if(f.oi!==void 0){if(e.oi!==void 0&&e.p[h]===f.p[h])if(g==="left")c.append(b,{p:e.p,od:f.oi});else return b}else if(f.od!==void 0&&e.p[h]===f.p[h]){if(!j)return b;if(e.oi!==void 0)delete e.od;else return b}}return c.append(b,e),b},typeof e!="undefined"&&e!==null?(f.types||(f.types={}),f._bt(c,c.transformComponent,c.checkValidOp,c.append),f.types.json=c):(module.exports=c,require("./helpers").bootstrapTransform(c,c.transformComponent,c.checkValidOp,c.append))}).call(this)