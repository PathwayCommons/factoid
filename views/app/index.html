<!--
  Derby templates are similar to Handlebars, except that they are first
  parsed as HTML, and there are a few extensions to make them work directly
  with models. A single HTML template defines the HTML output, the event
  handlers that update the model after user interaction, and the event handlers
  that update the DOM when the model changes.

  As in Handlebars, double curly braces output a value literally. Derby
  templates add single curly braces, which output a value and set up
  model <- -> view bindings for that object.

  Elements that end in colon define template names. Pre-defined templates
  are capitalized by convention, but template names are case-insensitive.
  Pre-defined templates are automatically included when the page is rendered.
-->

<import: src="qunit">

<Title:>
  Factoid demo

<Header:>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="HandheldFriendly" content="true" />

<Body:>
  <body class="">

  <app:help stage="textmining" icon="icon-arrow-right">

  <app:help stage="entities" icon="icon-arrow-right">

  <div class="help-content" data-for-stage="textmining">
    <h2>Enter abstract</h2>

    <div class="alert"><span class="icon-info-sign"></span> Enter your paper's abstract in the area to the right.  Factoid will find biological entities and interactions from your abstract and add them to the document.</div>

    <p><strong>N.B.</strong>: Although the help guides you through Factoid in a linear fashion, you are free to explore and use any part of Factoid in any order you wish.</p>

    <hr />

<!--
    <h2>FAQ</h2>

    <ul class="faq">
        <li><span class="question">What if this?</span> <span class="answer">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat.</span></li>
        
        <li><span class="question">What if that?</span> <span class="answer">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat.</span></li>

        <li><span class="question">What if the other?</span> <span class="answer">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit lobortis nisl ut aliquip ex ea commodo consequat.</span></li>
    </ul>

    <hr />
-->

    <app:contact>
    
  </div>

  <div class="help-content" data-for-stage="organisms">
    <h2>Choose organisms</h2>

    <div class="alert"><span class="icon-info-sign"></span> Factoid has automatically found organisms relevant to your abstract, but you may want to manually adjust them above.  The enabled organisms are used to refine entity searches.</div>

    <p><strong>N.B.</strong>: Although the help guides you through Factoid in a linear fashion, you are free to explore and use any part of Factoid in any order you wish.</p>

    <p class="skip"><button class="skip-button plain">Proceed to next step <span class="icon-fast-forward"></span></button></p>

    <hr />

    <app:contact>
    
  </div>

  <div class="help-content" data-for-stage="entities">
    <h2>Refine entities &amp; interactions</h2>

    <div class="alert">
      <span class="icon-info-sign"></span> Now that you have the basis of your document from your abstract and your chosen organisms, you can refine your list of biological entities and interactions:

      <ul>
        <li>Ensure that the identity of each entity is confirmed, indicated by a checkmark to the left of its name.</li>
        <li>Ensure that the list of participants for each interaction is correct.</li>
        <li>Add and remove entities and interactions to make certain that your document accurately represents your paper.</li>
      </ul>
    </div>

    <p><strong>N.B.</strong>: Although the help guides you through Factoid in a linear fashion, you are free to explore and use any part of Factoid in any order you wish.</p>

    <hr />

    <app:contact>
    
  </div>

  <div id="ui-loading-overlay" class="overlay ui-loaded-{bool(_loadedUi)}">
    <div class="overlay-wrapper">
      <div class="overlay-popup">
        Loading the Factoid editor... 
      </div>
    </div>
  </div>

  <div id="graph-layout-overlay" class="overlay">
    <div class="overlay-wrapper">
      <div class="overlay-popup">
        <span class="icon-refresh icon-spin"></span> <span>Repositioning entities</span>
      </div>
    </div>
  </div>

  <div id="textmining-overlay" class="overlay">
    <div class="overlay-wrapper">
      <div class="overlay-popup">
        <span class="icon-cog icon-spin"></span> <span>Analysing text</span>
      </div>
    </div>
  </div>

  <div id="info">
    <div id="tools">
      <div class="button-panel">
        <button id="textmining-button" data-tooltip="Add entities and interactions from text"><div class="alert-bubble"></div><span class="icon-plus"></span><span class="icon-file-text"></span> Abstract</button>
        <button id="add-entity-button" data-tooltip="Add entity"><span class="icon-plus"></span><span class="icon-circle"></span> Entity</button>
        <button id="add-interaction-button" data-tooltip="Add interaction"><span class="icon-plus"></span><span class="icon-stop"></span> Interaction</button>
      </div>

      <div class="popover-hidden-{not(_showTextmining)} popover-animated-{bool(_showTextminingAnimated)}">
        <app:popover classes="bottom textmining-popover">
            <app:textmining>
        </app:popover>
      </div>
    </div>

    <div id="entities-list">
      {#if _entities}
        {#each _entities as :entity}
          <app:entity>
        {/each}
      {else}
        <div class="info">
          <span class="icon-info-sign"></span> There are not yet any entities in the current document.  You can add entities with the buttons above.
        </div>
      {/if}
    </div>

  </div>

  <div id="organism-select">
    <div class="info">
      <span class="icon-info-sign"></span> Please select the organisms relevant to the document.  This helps to refine entity searches.
    </div>
    
    {#if organisms}
      {#each organisms as :organism}
        <app:organism>
      {/each}
    {/if}
  </div>

  <div id="description">
    <h1 id="description-title">Factoid: Building the future of scientific publishing</h1>
    <div id="description-content">
      <div class="scrollable-area">
        <p>Factoid helps authors to translate their written scientific text into formal descriptions of biological processes useful for sharing their results with others, bioinformatics analysis and integrating with other data to help build a more complete model of a cell.</p>

        <p>Factoid aims to be part of the publication process.  With the author's help, it will extract pathway and related information from a paper as it is submitted, submit the resulting diagram as a visual abstract for peer-review along with the paper and finally, publish the information in a shareable and computable format accompanying the paper for others to use.</p>

        <p>Factoid 1.0 helps turn text into a simple and editable network model of a biological process. Text is automatically converted to a first draft of a network which can then be corrected using easy to use editing functions.  Future versions will have more advanced text mining functionality to improve the 'first draft', will allow saving the results in standard formats for sharing and will make it easier to add text and edit the network.</p>
      </div>

      <div class="factoid-logo watermark-bottom-right">
        FACT<span class="o">O</span>ID
      </div>

      <button class="close-qtip-button">Done</button>
    </div>
  </div>

<textmining:>
  <div id="textmining-input">
    <div class="info">
      <span class="icon-info-sign"></span> The text you enter here will be used to automatically populate the document with the specified entities and interactions.
    </div>

    <div id="textmining-examples" class="examples">
      <a class="example prevent-default" tabindex="0" data-text="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.  PCNA and RAD51 do this.  MSH1 and MSH2 do that.  And MRE11A and MSH2 and RAD51 do the other in human."><span class="icon-paste"></span> Paste example abstract</a>
    </div>

    <div class="alert">
      <span class="icon-info-sign"></span> Nothing could be found in your text.  Please revise it, and try again.
    </div>

    <textarea id="textmining-text"></textarea>

    <div class="organism-preview">
      <label>Relevant organisms:</label>
      <div class="organisms">
        {#if organisms}
          {#each organisms as :organism}
            <app:organism>
          {/each}
        {/if}
      </div>
    </div>

    <div class="buttons">
      <button class="add"><span class="icon-plus"></span><span class="icon-circle"></span><span class="icon-stop"></span> Add to document</button>
    </div>

    <button class="output-info plain" tabindex="-1">
      <img src="/img/textmining-output.png"></img>
    </button>

    <app:help stage="organisms" icon="icon-arrow-up">

  </div>

<entity:>
  <div class="{:entity.type} entity-instance associated-{nonempty(:entity.association)} selected-{bool(:entity._selected)} moving-down-{bool(:entity._movingDown)} just-added-{bool(:entity._justAdded)}"  data-id="{{:entity.id}}" id="entity-{{:entity.id}}">
    
    <div class="selection-indicator"></div>

    {#if :entity.association}
      <button class="edit icon-ok associated-true tappable open-{bool(:entity._showEdit)}"></button>
    {else}
      <button class="edit icon-edit tappable open-{bool(:entity._showEdit)}"></button>
    {/if}
    
    <span class="name">
      {#if :entity.association}
        {:entity.name}
      {else}
        {#if :entity.interaction}
          {:entity.name}
        {else}
          <input class="edit-name-input input-like with-right-icon plain-{not(bool(:entity._showEdit))} loading-{bool(:entity._loadingPotentialAssociations)}" id="edit-name-input-{{:entity.id}}" data-id="{{:entity.id}}" type="text" value="{:entity.name}" />

          <button class="text-clear-icon icon-remove-sign right-input-icon tappable" data-for="edit-name-input-{{:entity.id}}"></button>
        {/if}
      {/if}
    </span>

    <span class="icons">
      <span class="buttonset annotation-icons with-{nonempty(:entity.annotation)}">
        <button class="annotations icon-with-false icon-comment-alt tappable open-{:entity._showAnnotations}"></button>
        <button class="annotations icon-with-true icon-comment tappable open-{:entity._showAnnotations}"></button>
      </span>
      
      {#if :entity.interaction}
        <button class="add-participants icon-plus-sign tappable open-{:entity._showAddParticipants}"></button>
      {else}
        <button class="icon-stop spacer-icon"></button>
      {/if}
      
      <button class="remove icon-remove tappable destructive"></button>
    </span>

    <div class="popover-hidden-{not(:entity._showAnnotations)} popover-animated-{bool(:entity._showAnnotationsAnimated)}">
      <app:popover classes="bottom annotations-popover">
        <app:annotations>
      </app:popover>
    </div>

    {#if :entity.interaction}
      <div class="popover-hidden-{not(:entity._showEdit)} popover-animated-{bool(:entity._showEditAnimated)}">
        <app:popover classes="bottom edit-interaction-popover">
          Future interaction edit UI.
        </app:popover>
      </div>

      <div class="popover-hidden-{not(:entity._showAddParticipants)} popover-animated-{bool(:entity._showAddParticipantsAnimated)}">
        <app:popover classes="bottom add-participants-popover">
          <app:addParticipants>
        </app:popover>
      </div>

      <app:participants>

    {else}
      <div class="popover-hidden-{not(:entity._showEdit)} popover-animated-{bool(:entity._showEditAnimated)}">
        <app:popover classes="bottom association-popover">
          <div id="association-ui-for-{:entity.id}" class="association-ui associated-{bool(:entity.association)}">
            {#if :entity.association}
              {#if :entity._associatedInfo}
                <app:associatedInfo>
              {else}
                <span class="loading-message">
                  <span class="loading-spinner-icon"></span> Loading entity information...
                </span>
              {/if}
            {else}
              <app:associateEntity>
            {/if}
          </div>
        </app:popover>
      </div>
    {/if}

  </div>

<help:>
  <div class="help-ball" data-stage="{{@stage}}" data-current-stage="{_doc.stage}">
    <div class="label">Help</div>

    <div class="indicator">
      <span class="{{@icon}}"></span>
    </div>
  </div>

<contact:>
  <h2>Contact us <small>(feedback, questions, etc)</small></h2>
  <div class="contact">
    <label>Your email</label>
    <input type="email" class="from" />

    <label>Your message</label>
    <textarea class="message">
      {{@message}}
    </textarea>
    <button class="send">Send <span class="icon-arrow-right"></span></button> <span class="sending-icon loading-spinner-icon"></span><span class="sent-icon icon-ok"></span>
  </div>

<annotations:>
  <label>Annotation</label>
  <button class="icon-remove-sign clear-icon tappable"><label>&nbsp;Clear</label></button>
  <textarea id="edit-annotation-{:entity.id}">{:entity.annotation}</textarea>

<organism:>
  <button class="plain organism organism-toggle enabled-{bool(:organism.documents[_doc.id].enabled)}" data-id="{:organism.id}">
    <span class="icon-ok enabled-icon"></span>
    <img class="icon" src="/img/organisms/{:organism.id}.png" />
    <span class="name">{:organism.sciName}</span>
  </button>

<participants:>
  <div class="participants-list" id="participants-list-for-{:entity.id}">
    {#if :entity._participants}
      <div class="small-title">Participants</div>
    {/if}
    
    {#each :entity._participants as :part}
      <div class="participant {:part.type}" data-id="{:part.id}">
        <span class="name">{:part.name}</span>
        <span class="icons">
          <button class="remove icon-remove-sign tappable"></button>
        </span>
      </div>
    {/each}
  </div>

<addParticipants:>
  <div class="add-participants-list" data-interaction-id="{:entity.id}" id="add-participants-list-for-{:entity.id}">
    {#if :entity._potentialParticipants}
      <div class="small-title">Select participants to add</div>
      {#each :entity._potentialParticipants as :part}
        <div class="participant {:part.type}" data-id="{:part.id}">
          <span class="name">{.name}</span>
          <span class="icons">
            <button class="add-participant icon-plus-sign tappable"></button>
          </span>
        </div>
      {/each}
    {else}
      <div class="info no-entities-message"><span class="icon-info-sign"></span> There are no other entities in the document to add.</div>
    {/if}
  </div>

<associateEntity:>
  <div class="associate-ui">   
    <div class="associations" data-entity-id="{:entity.id}">
      {#if :entity._potentialAssociations}
        {#each :entity._potentialAssociations as :assoc}
          <button class="associate-button" data-index="{:assoc.index}">
            <div class="name"><span class="icon-ok"></span> {:assoc.name}</div>
            <div class="full-name">{:assoc.fullName}</div>
            <div class="organism">{:assoc.organismName}</div>
            <div class="type">{:assoc.type}</div>
            {#if :assoc._organismSupported}
              <img class="organism-icon" src="/img/organisms/{:assoc.organismId}.png" />
            {/if}
          </button>

          {#if :assoc._alreadyExists}
            <app:popover classes="bottom popover-alert">
              <span class="icon-info-sign"></span> There is already an entity associated to this.  Each entity in the document must be unique.
            </app:popover>
          {/if}
        {/each}
      {else}
        {#if :entity.changedName}
          {#if :entity._loadingPotentialAssociations}
            <span class="loading-message">
              <span class="loading-spinner-icon"></span> Searching for entities...
            </span>
          {else}
            <div class="info">
              <span class="icon-info-sign"></span> No entities matching the specified name were found.  Please revise your search above.
            </div>
          {/if}
        {else}
          <div class="info">
            <span class="icon-info-sign"></span> When you modify the name of this entity, known entities matching that name will be displayed here.  Selecting one indicates the identity of this entity.
          </div>
        {/if}
      {/if}
    </div>
  </div>

<associatedInfo:>
  <div class="associated-info-ui">
    {#with :entity._associatedInfo}
      <div class="entity-info">
        <div class="summary">
          <div class="name">{name}</div>
          <div class="full-name">{fullName}</div>
          <div class="organism">{organismName}</div>
          <div class="type">{type}</div>
          <img class="organism-icon" src="/img/organisms/{organismId}.png" />
        </div>

        <div class="link-area">
          <a class="link" target="_blank" href="{link}">Full details at UniProt <span class="icon-external-link"></span></a>
        </div>

        <div class="function">
          <div class="text">{function}</div>
        </div>

        <div class="disassociate">
          <button class="active-area plain tappable" data-entity-id="{id}">
            <span class="associate-icon"><span class="icon-ok"></span></span>
            <span class="remove-icon"><span class="icon-remove"></span></span>
            <span class="label"> Disassociate</span>
          </button>
        </div>
      </div>
    {/with}
  </div>

  <popover: nonvoid>
    <div class="popover {{@classes}}">

      <div class="arrow">
        <div class="arrow-before"></div>
        <div class="arrow-after"></div>
      </div>

      {{#if @title}}
        <div class="popover-title">
          {{@title}}
        </div>
      {{/if}}

      <div class="popover-content">
        {{@content}}
      </div>
    </div>