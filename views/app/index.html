<!--
  Derby templates are similar to Handlebars, except that they are first
  parsed as HTML, and there are a few extensions to make them work directly
  with models. A single HTML template defines the HTML output, the event
  handlers that update the model after user interaction, and the event handlers
  that update the DOM when the model changes.

  As in Handlebars, double curly braces output a value literally. Derby
  templates add single curly braces, which output a value and set up
  model <- -> view bindings for that object.

  Elements that end in colon define template names. Pre-defined templates
  are capitalized by convention, but template names are case-insensitive.
  Pre-defined templates are automatically included when the page is rendered.
-->

<import: src="qunit">

<Title:>
  Factoid demo

<Header:>

<Body:>
  <div id="graph"></div>

  <div id="info">
    <div class="button-panel">
      <button id="add-entity-button"><span class="icon-plus"></span> Entity</button>
      <button id="add-interaction-button"><span class="icon-plus"></span> Interaction</button>
      <button id="textmining-button"><div class="alert-bubble"></div><span class="icon-plus"></span> Text</button>
    </div>

    <div id="entities-list">
      {#if _populatedEntities}
        {#each _populatedEntities}
          <app:entity>
        {/each}
      {else}
        <div class="info">
          <span class="icon-info-sign"></span> There are not yet any entities in the current document.  You can add entities with the buttons above.
        </div>
      {/if}
    </div>

  </div>

  <div id="description">
    <h1 id="description-title">Factoid: Building the future of scientific publishing</h1>
    <div id="description-content">
      <div class="scrollable-area">
        <p>Factoid helps authors to translate their written scientific text into formal descriptions of biological processes useful for sharing their results with others, bioinformatics analysis and integrating with other data to help build a more complete model of a cell.</p>

        <p>Factoid aims to be part of the publication process.  With the author's help, it will extract pathway and related information from a paper as it is submitted, submit the resulting diagram as a visual abstract for peer-review along with the paper and finally, publish the information in a shareable and computable format accompanying the paper for others to use.</p>

        <p>Factoid 1.0 helps turn text into a simple and editable network model of a biological process. Text is automatically converted to a first draft of a network which can then be corrected using easy to use editing functions.  Future versions will have more advanced text mining functionality to improve the 'first draft', will allow saving the results in standard formats for sharing and will make it easier to add text and edit the network.</p>
      </div>
    </div>
  </div>

  <div id="textmining-input" class="textmining-input">
    <div class="info"><span class="icon-info-sign"></span> The text you enter below will be used to automatically populate the document with the specified entities and interactions.</div>

    <textarea></textarea>

    <div class="alert no-entities-message"><span class="icon-info-sign"></span> Nothing found.  Please check your text.</div>

    <button class="next">Next <span class="icon-arrow-right"></span></button>
  </div>

  <div id="textmining-entities" class="textmining-entities">
    <div class="scrollable-area">
      <div class="textmining-results" id="textmining-results">
        <div class="info"><span class="icon-info-sign"></span> The following entities and interactions have been found.</div>

        <div class="potential-entities">
            {#each _populatedTextminingEntities}
              <app:entity>
            {/each}
        </div>
      </div>
    </div>

    <div class="button-panel">
      <button class="prev"><span class="icon-arrow-left"></span> Back</button>
      <button class="add"><span class="icon-plus"></span> Add to document</button>
    </div>
  </div>

<entity:>
  <div class="{type} entity-instance associated-{nonempty(associated)}" data-id="{id}" id="entity-{id}" data-popover-keep-open>
    {#if association}
      <span class="edit icon-ok"></span>
    {else}
      <span class="edit icon-edit"></span>
    {/if}
    <span class="name">{name}</span>
    <span class="icons">
      {#if interaction}
        <span class="add-participants icon-plus-sign open-{_showAddParticipants}"></span>
      {/if}
      <span class="remove icon-remove"></span>
    </span>

    {#if interaction}
      <div class="popover-hidden-{not(_showAddParticipants)} popover-animated-{_showAddParticipantsAnimated}">
        <app:popover classes="add-participants-popover">
          <app:addParticipants>
        </app:popover>
      </div>

      <app:participants>
    {else}
      <div id="association-ui-for-{id}" class="association-ui associated-{associated}">
        {#if association}
          {#if _associatedInfo}
            <app:associatedInfo>
          {else}
            <span class="loading-spinner-icon"></span> Loading entity information...
          {/if}
        {else}
          <app:associateEntity>
        {/if}
      </div>
    {/if}
    
  </div>

<participants:>
  <div class="participants-list" id="participants-list-for-{id}">
    {#each participants}
      <div class="participant {type}" data-id="{id}">
        <span class="name">{name}</span>
        <span class="icons">
          <span class="remove icon-remove-sign"></span>
        </span>
      </div>
    {/each}
  </div>

<addParticipants:>
  <div class="add-participants-list" data-interaction-id="{id}" id="add-participants-list-for-{id}">
    {#if potentialParticipants}
      {#each potentialParticipants}
        <div class="participant {type}" data-id="{id}">
          <span class="name">{name}</span>
          <span class="icons">
            <span class="add-participant icon-plus-sign"></span>
          </span>
        </div>
      {/each}
    {else}
      <div class="info no-entities-message"><span class="icon-info-sign"></span> There are no other entities in the document to add.</div>
    {/if}
  </div>

<associateEntity:>
  <div class="associate-ui">   
    <div class="associations" data-entity-id="{id}">
      {#if _potentialAssociations}
        {#each _potentialAssociations}
          <button class="associate-button" data-index="{index}">
            <div class="name"><span class="icon-ok"></span> {name}</div>
            <div class="full-name">aka {fullName} ({officialName})</div>
            <div class="organism">{organismName}</div>
            <div class="type">{type}</div>
          </button>
        {/each}
      {else}
        {#if _changedName}
          <div class="info">
            <span class="icon-info-sign"></span> No entities matching the specified name were found.  Please revise your search above.
          </div>
        {else}
          <div class="info">
            <span class="icon-info-sign"></span> When you modify the name of this entity, known entities matching that name will be displayed here.  Selecting one indicates the identity of this entity.
          </div>
        {/if}
      {/if}
    </div>
  </div>

<associatedInfo:>
  <div class="associated-info-ui">
    {#with _associatedInfo}
      <div class="entity-info">
        <div class="summary">
          <div class="name">{name}</div>
          <div class="full-name">aka {fullName} ({officialName})</div>
          <div class="organism">{organismName}</div>
          <div class="type">{type}</div>
        </div>

        <div class="link-area">
          <a class="link" target="_blank" href="{link}">Full details at UniProt <span class="icon-external-link"></span></a>
        </div>

        <div class="function">
          <div class="text">{function}</div>
        </div>
      </div>
    {/with}
  </div>

  <popover: nonvoid>
    <div class="popover bottom {{{classes}}}">
      <div class="arrow"></div>

      {{{#if title}}}
        <div class="popover-title">
          {{{title}}}
        </div>
      {{{/if}}}

      <div class="popover-content">
        {{{content}}}
      </div>
    </div>